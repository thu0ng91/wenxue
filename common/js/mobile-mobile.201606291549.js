/*!
 * NEWSOUL's production http://newsoul.cn
 * Copyright 2016
 * Author zmf http://blog.newsoul.cn
 * This is NOT a freeware, use is subject to license terms
 */
function rebind(){$("a[action=get-contents]").unbind("click").click(function(){var a=$(this);getContents(a)}),$("a[action=favorite]").unbind("click").click(function(){var a=$(this);favorite(a)}),$("a[action=vote]").unbind("click").click(function(){cancelBindLink();var a=$(this);addVote(a)}),$("a[action=add-comment]").click(function(){var a=$(this);addComment(a)}),$("a[action=zoom]").click(function(){var a=$(this);zoomThis(a)}),$(".comment-textarea").unbind("click").click(function(){setTimeout("scollToComment()",500)}),$("img.lazy").lazyload({threshold:600}),bindLink()}function bindLink(){$(".ui-grid-full li,.ui-list li,.ui-row li,.ui-avatar,.ui-col").unbind("click").click(function(){$(this).attr("data-href")&&(location.href=$(this).attr("data-href"))})}function cancelBindLink(){$(".ui-grid-full li,.ui-list li,.ui-row li,.ui-avatar,.ui-col").unbind("click")}function getContents(a){var b=a.attr("action-data"),c=a.attr("action-type"),d=a.attr("action-page"),e=a.attr("action-target");if(!checkAjax())return!1;if(!e)return!1;d||(d=1);var f="",g="";"magazine"===zmf.module?f="btn btn-default btn-block":(f="ui-btn-lg",g="ui-btn-wrap");var h='<div class="loading-holder '+g+'"><a class="'+f+' disabled" href="javascript:;">拼命加载中...</a></div>';$("#"+e+"-box").children(".loading-holder").each(function(){$(this).remove()}),$("#"+e+"-box").append(h),$.post(zmf.contentsUrl,{type:c,page:d,data:b,YII_CSRF_TOKEN:zmf.csrfToken},function(h){if(ajaxReturn=!0,a.attr("loaded","1"),h=$.parseJSON(h),1===h.status){var i=h.msg,j="",k="";if(""!==i.html&&(k+=i.html),1===i.loadMore){var l=parseInt(d)+1;j+='<div class="loading-holder '+g+'"><a class="'+f+'"  href="javascript:;" action="get-contents" action-type="'+c+'" action-data="'+b+'" action-page="'+l+'" action-target="'+e+'">加载更多</a></div>'}else j+='<div class="loading-holder '+g+'"><a class="'+f+' disabled" href="javascript:;">已全部加载</a></div>';1===d?($("#"+e+"-box").append(i.formHtml),$("#"+e+"-box .loading-holder").each(function(){$(this).remove()})):$("#"+e+"-box .loading-holder").each(function(){$(this).remove()}),d>1?$("#"+e).append(k):$("#"+e).html(k),$("#"+e+"-box").append(j),rebind()}else dialog({msg:h.msg})})}function dialog(a){if("object"!=typeof a)return!1;var b=a.msg,c=a.id,d=a.title,e=a.action,f=a.actionName,g=a.time,h=a.modalSize;$("#"+beforeModal).modal("hide"),("undefined"==typeof d||""===d)&&(d="提示"),("undefined"==typeof c||""===c)&&(c="myDialog"),"undefined"==typeof e&&(e=""),"undefined"==typeof h&&(h=""),$("#"+c).remove();var i='<div class="modal fade mymodal" id="'+c+'" tabindex="-1" role="dialog" aria-labelledby="'+c+'Label" aria-hidden="true"><div class="modal-dialog '+h+'"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="'+c+'Label">'+d+'</h4></div><div class="modal-body">'+b+'</div><div class="modal-footer">';if(i+='<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>',""!==e&&"undefined"!=typeof e){var j;j=""!==f&&"undefined"!=typeof f?f:"确定",i+='<button type="button" class="btn btn-primary" action="'+e+'" data-loading-text="Loading...">'+j+"</button>"}i+="</div></div></div></div>",$("body").append(i),$("#"+c).modal({backdrop:!1,keyboard:!1}),beforeModal=c,g>0&&"undefined"!=typeof g&&setTimeout("closeDialog('"+c+"')",1e3*g)}function closeDialog(a){a||(a="myDialog"),$("#"+a).modal("hide"),$("#"+a).remove(),$("body").eq(0).removeClass("modal-open")}function scollToComment(){$(".toggle-area").each(function(){$(this).fadeIn(500)});var a=($(window).height(),$(".comment-textarea").offset().top);$("body,html").animate({scrollTop:a},200)}function simpleDialog(a){if("object"!=typeof a)return!1;closeSimpleDialog();var b=a.content,c='<div class="simpleDialog">'+b+"</div>";$("body").append(c);var d=$(".simpleDialog"),e=d.width(),f=d.height();d.css({"margin-left":-e/2,"margin-top":-f/2}),d.fadeIn(300),setTimeout("closeSimpleDialog()",2700)}function closeSimpleDialog(){$(".simpleDialog").fadeOut(100).remove()}function checkAjax(){return ajaxReturn?(ajaxReturn=!1,!0):(dialog({msg:"请求正在发送中，请稍后"}),!1)}function addComment(dom){var k=dom.attr("action-data"),t=dom.attr("action-type"),to=parseInt($("#replyoneHolder-"+k).attr("tocommentid")),c=$("#content-"+t+"-"+k).val(),username=$("#username-"+t+"-"+k).val(),email=$("#email-"+t+"-"+k).val();if(!k||!t||!c)return dialog({msg:"请填写内容"}),!1;if(username||(username=""),email||(email=""),!checkLogin()){if(!username)return dialog({msg:"请填写称呼"}),!1;if(""!=email){var reg=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;if(!reg.test(email))return dialog({msg:"请填写正确的邮箱地址"}),!1}}return to||(to=0),checkAjax()?void $.post(zmf.addCommentUrl,{k:k,t:t,c:c,to:to,email:email,username:username,YII_CSRF_TOKEN:zmf.csrfToken},function(result){ajaxReturn=!0,result=eval("("+result+")"),"1"==result.status?($("#content-"+t+"-"+k).val(""),$("#comments-"+t+"-"+k).append(result.msg),cancelReplyOne(k)):dialog({msg:result.msg})}):!1}function favorite(a){var b=a.attr("action-data"),c=a.attr("action-type"),d=a.text();parseInt(d);return b&&c?!checkLogin()&&a.children("i").hasClass("fa-heart")?(dialog({msg:"已点赞",modalSize:"modal-sm"}),!1):checkAjax()?void $.post(zmf.favoriteUrl,{type:c,data:b,YII_CSRF_TOKEN:zmf.csrfToken},function(b){return ajaxReturn=!0,b=$.parseJSON(b),1===b.status?a.children("i").removeClass("fa-heart-o").addClass("fa-heart"):2===b.status?dialog({msg:b.msg}):3===b.status?a.children("i").removeClass("fa-heart").addClass("fa-heart-o"):dialog(4===b.status?{msg:b.msg}:{msg:b.msg}),!1}):!1:!1}function playVideo(a,b,c,d){var e=$(window).width()-10,f=9*e/16;if(!a||!b||!c)return!1;var g="";"youku"===a?g='<iframe src="http://player.youku.com/embed/'+b+'" height="'+f+'" width="'+e+'" allowtransparency="true" allowfullscreen="true" allowfullscreenInteractive="true" scrolling="no" border="0" frameborder="0"  height="'+f+'" width="'+e+'"></iframe>':"tudou"===a?g='<iframe src="http://www.tudou.com/programs/view/html5embed.action?type=2&'+b+'" allowtransparency="true" allowfullscreen="true" allowfullscreenInteractive="true" scrolling="no" border="0" frameborder="0"  height="'+f+'" width="'+e+'"></iframe>':"qq"===a&&(g='<iframe src="http://v.qq.com/iframe/player.html?vid='+b+'&tiny=0&auto=1" allowtransparency="true" allowfullscreen="true" allowfullscreenInteractive="true" scrolling="no" border="0" frameborder="0"  height="'+f+'" width="'+e+'"></iframe>'),$("#"+c).html(g),$(d).remove()}function replyOne(a,b,c){var d="<span class='reply-one'>回复“"+c+"”<a href='javascript:' onclick='cancelReplyOne("+b+")' title='取消设置'> <i class='ui-icon-close-page'></i></a></span>",e=$("#replyoneHolder-"+b).offset().top;$("html,body").animate({scrollTop:e},1e3),$("#replyoneHolder-"+b).attr("tocommentid",a).html(d)}function cancelReplyOne(a){$("#replyoneHolder-"+a).attr("tocommentid","").html("")}function showChapters(){var a=document.documentElement.clientHeight,b=document.documentElement.clientWidth,c=window.orientation,d=$("#next-prev-btns");0===Math.abs(c)&&a>=b;var e=d.width();d.css({left:(b-e)/2}).fadeIn(500)}function toggleChapters(){var a=$("#chapters-box"),b=a.html();dialog({msg:b,title:"跳转章节"})}function simpleLoading(a){if("object"!=typeof a)return!1;var b=a.title,c='<div class="simple-loading-box"><div class="loading-holder"><i class="fa fa-spinner"></i></div><div class="loading-title"><p>'+b+"</p></div></div>";$("body").append(c);var d=$(".simple-loading-box"),e=d.width(),f=d.height();d.css({"margin-left":-e/2,"margin-top":-f/2}),d.fadeIn(300),setTimeout("closeSimpleLoading()",2700)}function closeSimpleLoading(){$(".simple-loading-box").fadeOut(100).remove()}function checkLogin(){return"undefined"==typeof zmf.hasLogin?!1:"true"===zmf.hasLogin?!0:!1}function zoomThis(a){var b=a.attr("action-type"),c=a.attr("action-data");if(!b||!c)return!1;closeZoom();var d='<div class="zoom-box" id="zoom-box"><div class="zoom-close" onclick="closeZoom()"><i class="fa fa-remove"></i></div><div class="zoom-holder"><div class="zoom-content" id="zoom-holder"></div></div></div>';$("body").append(d);var e="";"img"==b&&(e='<img src="'+c+'"/>');var f=$("#zoom-box"),g=$(window).width(),h=$(window).height();$("#zoom-holder").css({width:g,height:h-20-15}).html(e),f.css({height:h-20}).animate({bottom:0},300)}function closeZoom(){var a=$("#zoom-box");a.animate({bottom:-1e3},150,"linear",function(){a.remove()})}var ajaxReturn=!0,beforeModal;$.support.pjax&&($(document).pjax("a:not([data-remote]):not([data-skip-pjax]):not([data-ajax=false]):not([target=_blank])","#pjax-container",{push:!0,scrollTo:0,fragment:"#pjax-container",timeout:5e3}),$(document).on("pjax:send",function(){simpleLoading({title:"正在加载中..."})}),$(document).on("pjax:complete",function(){closeSimpleLoading(),closeDialog(),rebind()})),!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(c){function f(){var b=0;h.each(function(){var c=a(this);if(!i.skip_invisible||"none"!==c.css("display"))if(a.abovethetop(this,i)||a.leftofbegin(this,i));else if(a.belowthefold(this,i)||a.rightoffold(this,i)){if(++b>i.failure_limit)return!1}else c.trigger("appear"),b=0})}var g,h=this,i={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!0,appear:null,load:null};return c&&(d!==c.failurelimit&&(c.failure_limit=c.failurelimit,delete c.failurelimit),d!==c.effectspeed&&(c.effect_speed=c.effectspeed,delete c.effectspeed),a.extend(i,c)),g=i.container===d||i.container===b?e:a(i.container),0===i.event.indexOf("scroll")&&g.on(i.event,function(){return f()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,c.one("appear",function(){if(!this.loaded){if(i.appear){var d=h.length;i.appear.call(b,d,i)}a("<img />").on("load",function(){var d,e;c.hide().attr("src",c.data(i.data_attribute))[i.effect](i.effect_speed),b.loaded=!0,d=a.grep(h,function(a){return!a.loaded}),h=a(d),i.load&&(e=h.length,i.load.call(b,e,i))}).attr("src",c.data(i.data_attribute))}}),0!==i.event.indexOf("scroll")&&c.on(i.event,function(){b.loaded||c.trigger("appear")})}),e.on("resize",function(){f()}),/iphone|ipod|ipad.*os 5/gi.test(navigator.appVersion)&&e.on("pageshow",function(b){b=b.originalEvent||b,b.persisted&&h.each(function(){a(this).trigger("appear")})}),a(b).on("load",function(){f()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?e.height()+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e[0].scrollX:a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e[0].scrollX:a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.fn,{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}($,window,document),rebind();